<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://connect-cdn.atl-paas.net/all.js" crossorigin="anonymous" ></script>
<script>
async function manual() {
  var token = document.getElementById("jwt").value;
  var body = {
  "expand": [
    "names",
    "schema",
    "operations"
  ],
  "fields": [
    "summary",
    "status",
    "assignee"
  ],
  "fieldsByKeys": false,
  "jql": "",
  "maxResults": 15,
  "startAt": 0
};
 try {
    const response = await fetch("https://gtola.atlassian.net/rest/api/2/search", {
      method: "POST",
      mode: "no-cors",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json",
        'Authorization': 'JWT '+token
      },
      body: JSON.stringify({}),
    });

    const result = await response.json();
    console.log("GT Success:", result);
  } catch (error) {
    console.error("GT Error:", error);
  }
  

}



function issues() {

AP.request({
    url: '/rest/api/3/search?fields=key,project,status&expand=transitions,changelog&startAt=0&maxResults=100000',
    type: 'GET',
    contentType: 'application/json',
    headers: { Accept: 'application/json' },
    success: function(responseText){
      console.log("success:"+responseText);
    },
    error: function(xhr, statusText, errorThrown){
      console.log("err: "+errorThrown);
    }
  });

}

function fn2workerURL(fn) {
  const blob = new Blob([`(${fn.toString()})()`], { type: "text/javascript" });
  return URL.createObjectURL(blob);
}

function workers() {
  let running = 0;
  for (let n = 0; n < 1; ++n) {
      var workers1 = new Worker("worker.js");//"worker.js"  fn2workerURL(issues)
      workers1.onmessage = workerDone;
      workers1.postMessage(AP);
      ++running;
  }
}

function workerDone(e) {
    --running;
    console.log("Worker " + e.data.id + " is done, result: " + e.data.sum);
    if (running === 0) {
        console.log("All workers complete");
    }
}

function GT(startAt) {
  if(!startAt) {
    startAt = { i:900 };
    for(var i =0;i<10*100; i++)
      AP.request({url: '/rest/api/3/search?fields=key,project,status&expand=transitions,changelog&startAt='+(i*100)+'&maxResults=100', type: 'GET', success: function(responseText){ console.log("GT res: "+ responseText); let data = JSON.parse(responseText); GT(startAt.i=startAt.i+1); }, error: function(xhr, statusText, errorThrown){ console.log("GT: Error while getting issue details: "+JSON.stringify(arguments)); }});
  } else {
    AP.request({url: '/rest/api/3/search?fields=key,project,status&expand=transitions,changelog&startAt='+(startAt.i*100)+'&maxResults=100', type: 'GET', success: function(responseText){ console.log("GT res: "+ responseText); let data = JSON.parse(responseText); GT(startAt.i=startAt.i+1); }, error: function(xhr, statusText, errorThrown){ console.log("GT: Error while getting issue details: "+JSON.stringify(arguments)); }});  
  }
}

function createCustomField() {
  AP.request({
    url: '/rest/api/3/field',
    type: 'POST',
    contentType: 'application/json',
    headers: { Accept: 'application/json' },
    data: JSON.stringify({
      "description": "Custom field for picking groups",
      "name": "New custom field",
      "searcherKey": "com.atlassian.jira.plugin.system.customfieldtypes:grouppickersearcher",
      "type": "com.atlassian.jira.plugin.system.customfieldtypes:grouppicker"
    }),
    success: function(responseText){
      alert("success:"+responseText);
    },
    error: function(xhr, statusText, errorThrown){
      alert("err: "+errorThrown);
    }
  });
}



var startAt=null;
function GT2() {   
  if(startAt===null) {
    startAt = { i:0 };
    for(startAt.i =0;startAt.i<10; startAt.i++) {
      AP.request({url: '/rest/api/3/search?fields=key,startAt='+(i*100)+'&maxResults=100', type: 'GET', success: function(responseText){
        console.log("GT res: "+ responseText);
        let data = JSON.parse(responseText);
        GT(); 
      }, error: function(xhr, statusText, errorThrown){ console.log("GT: Error while getting issue details: "+JSON.stringify(arguments)); }});  
    }
  } else {
    AP.request({url: '/rest/api/3/search?fields=key,startAt='+(i*100)+'&maxResults=100', type: 'GET', success: function(responseText){
      if(startAt.i>30)
        return;
      console.log("GT res: "+ responseText); 
      let data = JSON.parse(responseText); 
      startAt.i=startAt.i+1
      GT(); 
    }, error: function(xhr, statusText, errorThrown){ console.log("GT: Error while getting issue details: "+JSON.stringify(arguments)); }});  
  }
}

</script>
</head>
<body>
<h1>CONFIG<h1>
<input type="text" id="jwt"></input>
<button onclick="GT2()">GoGOGOGOGOOGOG</button>
<p id="gtolaResult"></p>
</body>
</html>